{% extends "base.html" %}

{% block title %}Pozisyonlar - Copy Trading{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 class="text-2xl font-bold">ðŸ’¹ Aktif Pozisyonlar</h1>
    <p class="text-gray-400">TÃ¼m traderlarÄ±n ÅŸu an aÃ§Ä±k pozisyonlarÄ±</p>
</div>

<!-- Stats Summary -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    {% set long_count = positions|selectattr('direction', 'equalto', 'LONG')|list|length %}
    {% set short_count = positions|selectattr('direction', 'equalto', 'SHORT')|list|length %}

    <div class="card rounded-xl p-4 text-center">
        <p class="text-gray-400 text-sm">Toplam</p>
        <p class="text-2xl font-bold">{{ positions|length }}</p>
    </div>
    <div class="card rounded-xl p-4 text-center">
        <p class="text-accent-green text-sm">LONG</p>
        <p class="text-2xl font-bold text-accent-green">{{ long_count }}</p>
    </div>
    <div class="card rounded-xl p-4 text-center">
        <p class="text-accent-red text-sm">SHORT</p>
        <p class="text-2xl font-bold text-accent-red">{{ short_count }}</p>
    </div>
    <div class="card rounded-xl p-4 text-center">
        <p class="text-gray-400 text-sm">Oran</p>
        <p class="text-2xl font-bold">{{ '%.0f'|format(long_count/(long_count+short_count)*100 if
            (long_count+short_count) > 0 else 50) }}% L</p>
    </div>
</div>

<div class="card rounded-xl p-6">
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead>
                <tr class="text-left text-gray-400 text-sm border-b border-dark-border">
                    <th class="pb-3">Trader</th>
                    <th class="pb-3">Sembol</th>
                    <th class="pb-3">YÃ¶n</th>
                    <th class="pb-3">GiriÅŸ</th>
                    <th class="pb-3">AnlÄ±k</th>
                    <th class="pb-3">KaldÄ±raÃ§</th>
                    <th class="pb-3">PnL</th>
                </tr>
            </thead>
            <tbody>
                {% for pos in positions %}
                <tr class="border-b border-dark-border/50 hover:bg-dark-bg transition">
                    <td class="py-3">
                        <a href="/trader/{{ pos.trader_uid }}" class="hover:text-accent-blue">
                            {{ pos.nickname or 'Unknown' }}
                        </a>
                    </td>
                    <td class="py-3 font-mono font-bold">{{ pos.symbol }}</td>
                    <td class="py-3">
                        <span
                            class="px-3 py-1 rounded text-xs font-bold
                            {% if pos.direction == 'LONG' %}bg-accent-green/20 text-accent-green glow-green{% else %}bg-accent-red/20 text-accent-red glow-red{% endif %}">
                            {{ pos.direction }}
                        </span>
                    </td>
                    <td class="py-3 font-mono">${{ '%.2f'|format(pos.entry_price) }}</td>
                    <td class="py-3 font-mono">${{ '%.2f'|format(pos.mark_price) }}</td>
                    <td class="py-3">{{ pos.leverage }}x</td>
                    <td
                        class="py-3 font-bold {% if pos.pnl_percent >= 0 %}text-accent-green{% else %}text-accent-red{% endif %}">
                        {{ '%+.2f'|format(pos.pnl_percent) }}%
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7" class="py-12 text-center text-gray-500">
                        <p class="text-4xl mb-4">ðŸ“­</p>
                        <p>Åžu an aÃ§Ä±k pozisyon yok.</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}